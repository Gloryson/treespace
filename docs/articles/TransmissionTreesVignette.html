<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>treespace worked example: Transmission trees • treespace</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">treespace</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>treespace worked example: Transmission trees</h1>
                        <h4 class="author">Michelle Kendall</h4>
            
          </div>

    
    
<div class="contents">
<p>This vignette demonstrates the use of <em>treespace</em> to compare a collection of transmission trees, as proposed in Kendall, Ayabina &amp; Colijn, 2016 <a href="http://arxiv.org/abs/1609.09051">arXiv:1609.09051</a>.</p>
<p>First we load the package <em>treespace</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(treespace)</code></pre></div>
<p><em>treespace</em> contains three functions for handling and comparing transmission trees:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/findMRCIs.html">findMRCIs()</a></code> which takes a “who infected whom matrix” (the information about infectors and infectees; more on this below) and outputs:</li>
</ol>
<ul>
<li><p><code>sourceCase</code>: the number of the node which is the source case, i.e. the common infector of all cases (outputs a warning if there is more than one source case).</p></li>
<li><p><code>mrcis</code>: a matrix where, for each pair of individuals i and j, the entry (i,j) is the node number of their MRCI. Note that if i infected j then this entry is i itself.</p></li>
<li><p><code>mrciDepths</code>: a matrix where, for each pair of individuals i and j, the entry (i,j) is the <em>depth</em> of their MRCI, defined as the number of edges from the source case. The source case has depth zero, its direct infectees have depth 1, and so on.</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p><code><a href="../reference/wiwTreeDist.html">wiwTreeDist()</a></code> which takes a list of <code>mrciDepths</code> matrices and computes the distances between them. You have to supply the list of sampled cases in which you are interested, and then it takes the Euclidean distance between each pair of matrices restricted to the sampled cases (and written long-hand, as a vector)</p></li>
<li><p><code><a href="../reference/wiwMedTree.html">wiwMedTree()</a></code> which takes a list of <code>mrciDepths</code> matrices, the list of sampled cases, an optional list of weights, and outputs the median transmission tree</p></li>
</ol>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#examples" class="anchor"> </a></body></html>Examples</h2>
<p>We define a “who infected whom matrix” as a matrix of two columns, where the first represents the infectors and the second represents their infectees. For example, a simple transmission chain could be represented like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tree1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">Infector=</span><span class="dv">1</span>:<span class="dv">5</span>,<span class="dt">Infectee=</span><span class="dv">2</span>:<span class="dv">6</span>) 
tree1</code></pre></div>
<pre><code>##      Infector Infectee
## [1,]        1        2
## [2,]        2        3
## [3,]        3        4
## [4,]        4        5
## [5,]        5        6</code></pre>
<p>This can be easily visualised as a transmission chain using graph plotting packages such as <em>igraph</em> or <em>visNetwork</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)
<span class="co"># set plotting options:</span>
<span class="kw">igraph_options</span>(<span class="dt">vertex.size=</span><span class="dv">15</span>,
               <span class="dt">vertex.color=</span><span class="st">"cyan"</span>,
               <span class="dt">vertex.label.cex=</span><span class="dv">2</span>,
               <span class="dt">edge.color=</span><span class="st">"lightgrey"</span>,
               <span class="dt">edge.arrow.size=</span><span class="dv">1</span>)

tree1graph &lt;-<span class="st"> </span><span class="kw">graph_from_edgelist</span>(tree1)
<span class="kw">plot</span>(tree1graph)</code></pre></div>
<p><img src="figs/igraph_tree1-1.png" width="672"></p>
<p>Applying the function <code>findMRCIs</code> gives the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/findMRCIs.html">findMRCIs</a></span>(tree1)</code></pre></div>
<pre><code>## $sourceCase
## [1] 1
## 
## $mrcis
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    1    1    1    1    1    1
## [2,]    1    2    2    2    2    2
## [3,]    1    2    3    3    3    3
## [4,]    1    2    3    4    4    4
## [5,]    1    2    3    4    5    5
## [6,]    1    2    3    4    5    6
## 
## $mrciDepths
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0    0    0    0    0
## [2,]    0    1    1    1    1    1
## [3,]    0    1    2    2    2    2
## [4,]    0    1    2    3    3    3
## [5,]    0    1    2    3    4    4
## [6,]    0    1    2    3    4    5</code></pre>
<div id="comparing-three-simple-trees" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#comparing-three-simple-trees" class="anchor"> </a></body></html>Comparing three simple trees</h3>
<p>Suppose we had other hypotheses for the transmission tree which describes who infected whom amongst these six cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a second scenario:</span>
tree2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">Infector=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="dt">Infectee=</span><span class="dv">2</span>:<span class="dv">6</span>)
tree2</code></pre></div>
<pre><code>##      Infector Infectee
## [1,]        1        2
## [2,]        5        3
## [3,]        2        4
## [4,]        2        5
## [5,]        3        6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tree2graph &lt;-<span class="st"> </span><span class="kw">graph_from_edgelist</span>(tree2)
<span class="kw">plot</span>(tree2graph)</code></pre></div>
<p><img src="figs/trees2_and_3-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># and a third scenario:</span>
tree3 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">Infector=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">6</span>),<span class="dt">Infectee=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">5</span>)) 
tree3</code></pre></div>
<pre><code>##      Infector Infectee
## [1,]        2        1
## [2,]        2        3
## [3,]        2        4
## [4,]        2        6
## [5,]        6        5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tree3graph &lt;-<span class="st"> </span><span class="kw">graph_from_edgelist</span>(tree3)
<span class="kw">plot</span>(tree3graph)</code></pre></div>
<p><img src="figs/trees2_and_3-2.png" width="672"></p>
<p>Then we can use <em>treespace</em> functions to make the following comparisons:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/findMRCIs.html">findMRCIs</a></span>(tree1) <span class="co"># find the source case, MRCIs and MRCI depths for tree 1</span>
m2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/findMRCIs.html">findMRCIs</a></span>(tree2)
m3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/findMRCIs.html">findMRCIs</a></span>(tree3)

matList &lt;-<span class="st"> </span><span class="kw">list</span>(m1$mrciDepths,m2$mrciDepths,m3$mrciDepths) <span class="co"># create a list of the mrciDepths matrices</span>
matList</code></pre></div>
<pre><code>## [[1]]
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0    0    0    0    0
## [2,]    0    1    1    1    1    1
## [3,]    0    1    2    2    2    2
## [4,]    0    1    2    3    3    3
## [5,]    0    1    2    3    4    4
## [6,]    0    1    2    3    4    5
## 
## [[2]]
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0    0    0    0    0
## [2,]    0    1    1    1    1    1
## [3,]    0    1    3    1    2    3
## [4,]    0    1    1    2    1    1
## [5,]    0    1    2    1    2    2
## [6,]    0    1    3    1    2    4
## 
## [[3]]
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    1    0    0    0    0    0
## [2,]    0    0    0    0    0    0
## [3,]    0    0    1    0    0    0
## [4,]    0    0    0    1    0    0
## [5,]    0    0    0    0    2    1
## [6,]    0    0    0    0    1    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/wiwTreeDist.html">wiwTreeDist</a></span>(matList, <span class="dt">sampled=</span><span class="dv">1</span>:<span class="dv">6</span>) <span class="co"># find the Euclidean distances between these matrices, where all six cases are sampled</span></code></pre></div>
<pre><code>##        1      2
## 2  5.916       
## 3 10.630  7.616</code></pre>
<p>If we had only sampled cases 4, 5 and 6, so that “1”, “2” and “3” could be regarded as arbitrary names of inferred, unsampled cases, we would compute:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/wiwTreeDist.html">wiwTreeDist</a></span>(matList, <span class="dt">sampled=</span><span class="dv">4</span>:<span class="dv">6</span>)</code></pre></div>
<pre><code>##       1     2
## 2 5.477      
## 3 8.832 4.000</code></pre>
<p>which substantially changes the measures of similarities and differences between the trees.</p>
</div>
<div id="comparing-many-trees-using-an-mds-plot" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#comparing-many-trees-using-an-mds-plot" class="anchor"> </a></body></html>Comparing many trees using an MDS plot</h3>
<p>Finally, we demonstrate comparing a larger set of transmission trees and finding the median:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
num &lt;-<span class="st"> </span><span class="dv">500</span>

<span class="co"># create a list of 500 random transmission trees with 11 cases, where the source case is fixed as case 1:</span>
treelistSC1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:num, function(x) {
  edges &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">6</span>)$edge <span class="co"># effectively creating a random transmission scenario</span>
  relabel &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">11</span>) <span class="co"># create a relabelling so that infections don't all happen in numerical order, but we force the source case to be 1:</span>
  relabel[[<span class="kw">which</span>(relabel==<span class="dv">1</span>)]] &lt;-<span class="st"> </span>relabel[[<span class="dv">7</span>]]
  relabel[[<span class="dv">7</span>]] &lt;-<span class="st"> </span><span class="dv">1</span>
  relabelledEdges1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(edges[,<span class="dv">1</span>], function(x) relabel[[x]])
  relabelledEdges2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(edges[,<span class="dv">2</span>], function(x) relabel[[x]])
  <span class="kw">cbind</span>(relabelledEdges1,relabelledEdges2)
})

<span class="co"># create 500 more random transmission trees, but where the source case is fixed as case 2:</span>
treelistSC2 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:num, function(x) {
  edges &lt;-<span class="st"> </span><span class="kw">rtree</span>(<span class="dv">6</span>)$edge 
  relabel &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">11</span>) 
  relabel[[<span class="kw">which</span>(relabel==<span class="dv">2</span>)]] &lt;-<span class="st"> </span>relabel[[<span class="dv">7</span>]]
  relabel[[<span class="dv">7</span>]] &lt;-<span class="st"> </span><span class="dv">2</span>
  relabelledEdges1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(edges[,<span class="dv">1</span>], function(x) relabel[[x]])
  relabelledEdges2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(edges[,<span class="dv">2</span>], function(x) relabel[[x]])
  <span class="kw">cbind</span>(relabelledEdges1,relabelledEdges2)
})

<span class="co"># combine:</span>
combinedLists &lt;-<span class="st"> </span><span class="kw">c</span>(treelistSC1,treelistSC2)

<span class="co"># get mrciDepths matrices:</span>
matList1000 &lt;-<span class="st"> </span><span class="kw">lapply</span>(combinedLists, function(x)
  <span class="kw"><a href="../reference/findMRCIs.html">findMRCIs</a></span>(x)$mrciDepths
)

<span class="co"># find pairwise tree distances, treating all cases as sampled:</span>
WiwDists1000 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/wiwTreeDist.html">wiwTreeDist</a></span>(matList1000, <span class="dt">sampled=</span><span class="dv">1</span>:<span class="dv">11</span>)</code></pre></div>
<p>Now that we have a pairwise distance matrix we can use multidimensional scaling (MDS) to view the relative distances between the trees in a 2D projection. We will colour the points in the projection by the “depth” of the corresponding tree, and use symbols to indicate the source case. For “depth” here we simply use the mean of each “mrciDepths” matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wiwMDS &lt;-<span class="st"> </span><span class="kw">dudi.pco</span>(WiwDists1000, <span class="dt">scannf=</span><span class="ot">FALSE</span>, <span class="dt">nf=</span><span class="dv">3</span>)

<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(RColorBrewer)

wiwPlot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(wiwMDS$li, <span class="kw">aes</span>(<span class="dt">x=</span>wiwMDS$li[,<span class="dv">1</span>],<span class="dt">y=</span>wiwMDS$li[,<span class="dv">2</span>]))

<span class="co"># prepare aesthetics</span>
depths &lt;-<span class="st"> </span><span class="kw">sapply</span>(matList1000, function(x) <span class="kw">mean</span>(x))
sourcecase &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">"1"</span>,num),<span class="kw">rep</span>(<span class="st">"2"</span>,num))

<span class="co"># prepare colours:</span>
colfunc &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">brewer.pal</span>(<span class="dv">10</span>,<span class="st">"Spectral"</span>), <span class="dt">space=</span><span class="st">"Lab"</span>)

wiwPlot +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">colour=</span><span class="st">"gray60"</span>, <span class="kw">aes</span>(<span class="dt">shape=</span>sourcecase)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="kw">aes</span>(<span class="dt">colour=</span>depths, <span class="dt">shape=</span>sourcecase)) +
<span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="st">"Mean of v</span><span class="ch">\n</span><span class="st">"</span>, 
                         <span class="dt">colours=</span><span class="kw">colfunc</span>(<span class="dv">7</span>),
                         <span class="dt">guide =</span> <span class="kw">guide_colourbar</span>(<span class="dt">barheight=</span><span class="dv">10</span>)) +
<span class="st">  </span><span class="kw">scale_shape_discrete</span>(<span class="st">"Source case</span><span class="ch">\n</span><span class="st">"</span>, <span class="dt">solid=</span>T, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">keyheight =</span> <span class="dv">3</span>, <span class="dt">keywidth=</span><span class="fl">1.5</span>)) +
<span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">""</span>) +
<span class="st">  </span><span class="kw">theme</span>(
    <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),
    <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>),
    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>), <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">20</span>)) +
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">""</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">""</span>)</code></pre></div>
<p><img src="figs/wiw_MDS1000-1.png" width="672"></p>
<p>The symmetry in the plot corresponds to the different source cases, and the trees are also clearly separated by depth.</p>
</div>
<div id="median-trees" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#median-trees" class="anchor"> </a></body></html>Median trees</h3>
<p>If our transmission trees corresponded to real data it could be meaningful to find a single representative tree. To find the geometric median tree(s) from a collection, we use the function <code>wiwMedTree</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">med &lt;-<span class="st"> </span><span class="kw"><a href="../reference/wiwMedTree.html">wiwMedTree</a></span>(matList1000)</code></pre></div>
<p>This returns a list with components:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(med)</code></pre></div>
<pre><code>## [1] "centre"    "distances" "mindist"   "median"</code></pre>
<ul>
<li><p><code>centre</code> is the mean vector (which may not necessarily correspond to a valid transmission tree with a single source case)</p></li>
<li><p><code>distances</code> gives the distance of each tree from the centre, as a vector</p></li>
<li><p><code>mindist</code> gives the minimum of these distances</p></li>
<li><p><code>median</code> gives the number(s) of the median tree(s)</p></li>
</ul>
<p>Here the median tree is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">med$median</code></pre></div>
<pre><code>## [1] 357</code></pre>
<p>and looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">medgraph &lt;-<span class="st"> </span><span class="kw">graph_from_edgelist</span>(combinedLists[[med$median]])
<span class="kw">plot</span>(medgraph)</code></pre></div>
<p><img src="figs/wiwMedTreePlot-1.png" width="672"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#examples">Examples</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Michelle Kendall, Jacob Almagro-Garcia, Caroline Colijn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
